---
import PageLayout from "../../layouts/PageLayout.astro";
import H1 from "../../components/ui/H1.astro";
import EventTimeline from "../../components/srtp/EventTimeline.astro";
import { getCollection } from 'astro:content';
import { getLanguageFromURL } from "../../lib/translations";
import { Image } from 'astro:assets';

// Get all SRTP events from content collection
const srtpEvents = await getCollection('srtpEvents');

// Get current language
const lang = getLanguageFromURL(Astro.url);

// Import images that we'll need
import readingSeminarImage from "../../assets/reading-seminar.png";
---

<PageLayout
  title="Sinthome Reading, Theory, Praxis (S.R.T.P.) - Sinthome"
  description="A radical education collective bridging theory and praxis through reading seminars, philosophy lectures, and critical discussions."
>
  <H1>Sinthome Reading, Theory, Praxis</H1>

  <!-- Hero Section -->
  <section class="mb-12">
    <p class="text-xl text-zinc-400 mb-8 max-w-3xl">
      S.R.T.P. is a <span class="text-red-400 font-semibold">radical education collective</span> that brings together
      activists, scholars, and community members to engage with revolutionary theory and its practical applications.
    </p>

    <!-- Quick Stats Bar -->
    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-8">
      <div class="bg-zinc-900/50 border border-zinc-800 rounded-lg p-4">
        <div class="text-2xl font-bold text-red-500">{srtpEvents.length}+</div>
        <div class="text-sm text-zinc-500">Events Hosted</div>
      </div>
      <div class="bg-zinc-900/50 border border-zinc-800 rounded-lg p-4">
        <div class="text-2xl font-bold text-red-500">Weekly</div>
        <div class="text-sm text-zinc-500">Reading Groups</div>
      </div>
      <div class="bg-zinc-900/50 border border-zinc-800 rounded-lg p-4">
        <div class="text-2xl font-bold text-red-500">Free</div>
        <div class="text-sm text-zinc-500">Always Open Access</div>
      </div>
    </div>

    <!-- CTA Section -->
    <div class="flex flex-wrap gap-4">
      <a
        href="#past-events"
        class="px-6 py-3 bg-red-600 text-white font-medium rounded-lg hover:bg-red-700 transition"
      >
        Browse Past Events
      </a>
      <a
        href="#join"
        class="px-6 py-3 border border-zinc-700 text-zinc-300 font-medium rounded-lg hover:bg-zinc-900 transition"
      >
        Join Our Next Session
      </a>
    </div>
  </section>

  <!-- What We Do -->
  <section class="mb-16">
    <h2 class="text-2xl font-bold text-white mb-6">What We Do</h2>

    <div class="grid md:grid-cols-3 gap-6 mb-8">
      <div class="bg-zinc-900/50 border border-zinc-800 rounded-xl p-6">
        <div class="w-12 h-12 bg-red-600/20 rounded-lg flex items-center justify-center mb-4">
          <svg class="w-6 h-6 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
          </svg>
        </div>
        <h3 class="text-lg font-semibold text-white mb-2">Reading Seminars</h3>
        <p class="text-zinc-400 text-sm">
          Weekly gatherings to collectively read and discuss revolutionary texts, from Marx to contemporary critical theory.
        </p>
      </div>

      <div class="bg-zinc-900/50 border border-zinc-800 rounded-xl p-6">
        <div class="w-12 h-12 bg-red-600/20 rounded-lg flex items-center justify-center mb-4">
          <svg class="w-6 h-6 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
          </svg>
        </div>
        <h3 class="text-lg font-semibold text-white mb-2">Philosophy Lectures</h3>
        <p class="text-zinc-400 text-sm">
          Deep dives into critical philosophy, connecting abstract concepts to concrete political struggles.
        </p>
      </div>

      <div class="bg-zinc-900/50 border border-zinc-800 rounded-xl p-6">
        <div class="w-12 h-12 bg-red-600/20 rounded-lg flex items-center justify-center mb-4">
          <svg class="w-6 h-6 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
          </svg>
        </div>
        <h3 class="text-lg font-semibold text-white mb-2">Practice Groups</h3>
        <p class="text-zinc-400 text-sm">
          Workshops connecting theoretical insights to organizing strategies and community action.
        </p>
      </div>
    </div>

    <!-- Current Focus -->
    <div class="bg-gradient-to-r from-red-900/20 to-transparent border border-red-600/30 rounded-xl p-6">
      <h3 class="text-lg font-semibold text-white mb-3">Current Focus Areas</h3>
      <ul class="grid sm:grid-cols-2 gap-3 text-zinc-400">
        <li class="flex items-start gap-2">
          <span class="text-red-500 mt-1">→</span>
          <span>Dialectical materialism and revolutionary methodology</span>
        </li>
        <li class="flex items-start gap-2">
          <span class="text-red-500 mt-1">→</span>
          <span>Phenomenology of suffering and bodily ethics</span>
        </li>
        <li class="flex items-start gap-2">
          <span class="text-red-500 mt-1">→</span>
          <span>Social space production and urban struggle</span>
        </li>
        <li class="flex items-start gap-2">
          <span class="text-red-500 mt-1">→</span>
          <span>Labor organization and worker consciousness</span>
        </li>
      </ul>
    </div>
  </section>

  <!-- Past Events Timeline -->
  <section id="past-events" class="mb-16">
    <div class="flex items-center justify-between mb-8">
      <h2 class="text-2xl font-bold text-white">Past Events</h2>
      <div class="flex gap-2">
        <button
          onclick="toggleView('timeline')"
          id="timeline-btn"
          class="px-4 py-2 text-sm font-medium bg-zinc-800 text-white rounded-lg transition"
        >
          Timeline
        </button>
        <button
          onclick="toggleView('grid')"
          id="grid-btn"
          class="px-4 py-2 text-sm font-medium text-zinc-400 hover:text-white hover:bg-zinc-800 rounded-lg transition"
        >
          Grid
        </button>
      </div>
    </div>

    <!-- Timeline View (default) -->
    <div id="timeline-view">
      <EventTimeline events={srtpEvents} lang={lang} />
    </div>

    <!-- Grid View (hidden by default) -->
    <div id="grid-view" class="hidden">
      <div class="grid md:grid-cols-2 xl:grid-cols-3 gap-6">
        {srtpEvents.sort((a, b) => b.data.date.getTime() - a.data.date.getTime()).map((event) => (
          <article class="group bg-gradient-to-br from-zinc-900/80 via-zinc-900/50 to-zinc-900/30 border border-zinc-800 rounded-xl overflow-hidden hover:border-red-600/50 hover:shadow-2xl hover:shadow-red-900/20 transition-all duration-300">
            <!-- Event Image -->
            {event.data.poster && (
              <div class="relative overflow-hidden">
                <Image
                  src={event.data.poster}
                  alt={`${event.data.title} poster`}
                  class="w-full h-48 object-cover transition-transform duration-500 group-hover:scale-105"
                  loading="lazy"
                  format="webp"
                />
                <div class="absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                <!-- Event Type Badge on Image -->
                <div class="absolute top-4 left-4">
                  <span class="px-3 py-1 text-xs font-bold bg-red-600/90 text-white rounded-full backdrop-blur-sm">
                    {event.data.type}
                  </span>
                </div>
                <!-- Featured Badge -->
                {event.data.featured && (
                  <div class="absolute top-4 right-4">
                    <span class="px-2 py-1 text-xs font-bold bg-yellow-500/90 text-black rounded-full backdrop-blur-sm">
                      Featured
                    </span>
                  </div>
                )}
              </div>
            )}

            <!-- Card Content -->
            <div class="p-6">
              <!-- Metadata Row -->
              <div class="flex flex-wrap gap-2 mb-4">
                {!event.data.poster && (
                  <span class="px-3 py-1 text-xs font-medium bg-red-600/20 text-red-400 rounded-full">
                    {event.data.type}
                  </span>
                )}
                <span class="px-3 py-1 text-xs font-medium bg-zinc-800 text-zinc-400 rounded-full">
                  {event.data.date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}
                </span>
                <span class="px-3 py-1 text-xs font-medium bg-zinc-800 text-zinc-400 rounded-full">
                  {event.data.duration}
                </span>
              </div>

              <!-- Title -->
              <h3 class="text-lg font-bold text-white mb-3 line-clamp-2 group-hover:text-red-300 transition-colors">
                {lang === 'zh' ? event.data.titleZh : event.data.title}
              </h3>

              <!-- Synopsis -->
              <p class="text-zinc-400 text-sm mb-4 line-clamp-3 leading-relaxed">
                {lang === 'zh' ? event.data.synopsisZh : event.data.synopsis}
              </p>

              <!-- Quote (if available) -->
              {event.data.quote && (
                <blockquote class="border-l-2 border-red-600/50 pl-3 text-xs text-zinc-500 italic mb-4 line-clamp-2">
                  "{event.data.quote}"
                </blockquote>
              )}

              <!-- Tags -->
              <div class="flex flex-wrap gap-1 mb-4">
                {event.data.tags.slice(0, 3).map(tag => (
                  <span class="text-xs text-zinc-600 bg-zinc-800/50 px-2 py-1 rounded">
                    #{tag}
                  </span>
                ))}
                {event.data.tags.length > 3 && (
                  <span class="text-xs text-zinc-600">
                    +{event.data.tags.length - 3} more
                  </span>
                )}
              </div>

              <!-- Actions -->
              <div class="flex flex-col gap-3">
                <a
                  href={`/events/${event.id}`}
                  class="w-full text-center px-4 py-2 bg-gradient-to-r from-red-600 to-red-700 text-white text-sm font-semibold rounded-lg hover:from-red-700 hover:to-red-800 transition-all duration-200 shadow-md hover:shadow-lg"
                >
                  Read Full Event
                </a>
                {event.data.recordingUrl && (
                  <a
                    href={event.data.recordingUrl}
                    target="_blank"
                    rel="noopener noreferrer"
                    class="w-full text-center px-4 py-2 border border-zinc-600 text-zinc-300 text-sm font-medium rounded-lg hover:bg-zinc-800 hover:border-zinc-500 transition-all duration-200 flex items-center justify-center gap-2"
                  >
                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                      <path d="M2 6a2 2 0 012-2h6a2 2 0 012 2v8a2 2 0 01-2 2H4a2 2 0 01-2-2V6zM14.553 7.106A1 1 0 0014 8v4a1 1 0 00.553.894l2 1A1 1 0 0018 13V7a1 1 0 00-1.447-.894l-2 1z"></path>
                    </svg>
                    Watch Recording
                  </a>
                )}
              </div>
            </div>
          </article>
        ))}
      </div>
    </div>
  </section>

  <!-- Join Section -->
  <section id="join" class="mb-16">
    <div class="bg-gradient-to-br from-red-900/20 via-zinc-900/50 to-transparent border border-red-600/30 rounded-xl p-8">
      <h2 class="text-2xl font-bold text-white mb-4">Join Our Community</h2>
      <p class="text-zinc-400 mb-6 max-w-2xl">
        S.R.T.P. sessions are free and open to all. No prior knowledge required—just a commitment to collective learning and radical imagination.
      </p>

      <div class="grid sm:grid-cols-2 gap-6 mb-8">
        <div>
          <h3 class="text-lg font-semibold text-white mb-3">Next Session</h3>
          <p class="text-zinc-400 mb-2">📅 Every Saturday, 2:00 PM</p>
          <p class="text-zinc-400 mb-2">📍 175 Washington St, Brighton, MA</p>
          <p class="text-zinc-400">💬 Also available online via Zoom</p>
        </div>
        <div>
          <h3 class="text-lg font-semibold text-white mb-3">Stay Updated</h3>
          <p class="text-zinc-400 mb-4">
            Get notified about upcoming events, reading materials, and discussion topics.
          </p>
          <a
            href="/contact"
            class="inline-block px-6 py-3 bg-red-600 text-white font-medium rounded-lg hover:bg-red-700 transition"
          >
            Join Mailing List
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- FAQ Section -->
  <section class="mb-16">
    <h2 class="text-2xl font-bold text-white mb-6">Frequently Asked Questions</h2>

    <div class="space-y-4">
      <details class="group bg-zinc-900/50 border border-zinc-800 rounded-lg">
        <summary class="cursor-pointer p-6 text-white font-medium hover:text-red-400 transition">
          Do I need to prepare anything before attending?
        </summary>
        <div class="px-6 pb-6 text-zinc-400">
          Not at all! While we often share reading materials in advance, you're welcome to join even if you haven't read them. The discussion itself is where learning happens.
        </div>
      </details>

      <details class="group bg-zinc-900/50 border border-zinc-800 rounded-lg">
        <summary class="cursor-pointer p-6 text-white font-medium hover:text-red-400 transition">
          Are sessions really free?
        </summary>
        <div class="px-6 pb-6 text-zinc-400">
          Yes, completely free. We believe education should be accessible to all. We're funded through community donations and solidarity economy practices.
        </div>
      </details>

      <details class="group bg-zinc-900/50 border border-zinc-800 rounded-lg">
        <summary class="cursor-pointer p-6 text-white font-medium hover:text-red-400 transition">
          Can I propose topics or lead a session?
        </summary>
        <div class="px-6 pb-6 text-zinc-400">
          Absolutely! S.R.T.P. is collectively organized. Contact us with your ideas, and we'll work together to make it happen.
        </div>
      </details>

      <details class="group bg-zinc-900/50 border border-zinc-800 rounded-lg">
        <summary class="cursor-pointer p-6 text-white font-medium hover:text-red-400 transition">
          Is this affiliated with any political party?
        </summary>
        <div class="px-6 pb-6 text-zinc-400">
          No. While we engage with radical and revolutionary theory, S.R.T.P. is an independent collective not affiliated with any political party or organization.
        </div>
      </details>

      <details class="group bg-zinc-900/50 border border-zinc-800 rounded-lg">
        <summary class="cursor-pointer p-6 text-white font-medium hover:text-red-400 transition">
          Are recordings available?
        </summary>
        <div class="px-6 pb-6 text-zinc-400">
          Yes! Most sessions are recorded and posted to our Bilibili channel. Check the past events section for links to specific recordings.
        </div>
      </details>

      <details class="group bg-zinc-900/50 border border-zinc-800 rounded-lg">
        <summary class="cursor-pointer p-6 text-white font-medium hover:text-red-400 transition">
          How can I support S.R.T.P.?
        </summary>
        <div class="px-6 pb-6 text-zinc-400">
          Join us! Your participation is the best support. You can also help by sharing events, volunteering to facilitate, or contributing to our solidarity fund.
        </div>
      </details>
    </div>
  </section>
</PageLayout>

<script>
  function toggleView(view: 'timeline' | 'grid') {
    const timelineView = document.getElementById('timeline-view');
    const gridView = document.getElementById('grid-view');
    const timelineBtn = document.getElementById('timeline-btn');
    const gridBtn = document.getElementById('grid-btn');

    if (view === 'timeline') {
      timelineView?.classList.remove('hidden');
      gridView?.classList.add('hidden');
      timelineBtn?.classList.add('bg-zinc-800', 'text-white');
      timelineBtn?.classList.remove('text-zinc-400', 'hover:text-white', 'hover:bg-zinc-800');
      gridBtn?.classList.remove('bg-zinc-800', 'text-white');
      gridBtn?.classList.add('text-zinc-400', 'hover:text-white', 'hover:bg-zinc-800');
    } else {
      timelineView?.classList.add('hidden');
      gridView?.classList.remove('hidden');
      gridBtn?.classList.add('bg-zinc-800', 'text-white');
      gridBtn?.classList.remove('text-zinc-400', 'hover:text-white', 'hover:bg-zinc-800');
      timelineBtn?.classList.remove('bg-zinc-800', 'text-white');
      timelineBtn?.classList.add('text-zinc-400', 'hover:text-white', 'hover:bg-zinc-800');
    }
  }

  // Add to global scope for onclick handlers
  (window as any).toggleView = toggleView;
</script>

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  /* Enhanced card hover effects */
  .group:hover {
    transform: translateY(-2px);
  }

  /* Smooth image scaling */
  .group img {
    transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .group:hover img {
    transform: scale(1.05);
  }

  /* Custom scrollbar for horizontal navigation */
  .timeline-nav::-webkit-scrollbar {
    height: 4px;
  }

  .timeline-nav::-webkit-scrollbar-track {
    background: rgb(39 39 42);
  }

  .timeline-nav::-webkit-scrollbar-thumb {
    background: rgb(113 113 122);
    border-radius: 2px;
  }

  .timeline-nav::-webkit-scrollbar-thumb:hover {
    background: rgb(161 161 170);
  }

  /* Details/FAQ styling */
  details summary::-webkit-details-marker {
    display: none;
  }

  details summary::before {
    content: '+';
    position: absolute;
    right: 1.5rem;
    font-size: 1.5rem;
    transition: transform 0.3s ease;
    color: rgb(220 38 38);
  }

  details[open] summary::before {
    transform: rotate(45deg);
  }

  /* Gradient borders for featured cards */
  .featured-gradient {
    background: linear-gradient(135deg, rgba(220, 38, 38, 0.1), rgba(220, 38, 38, 0.05));
    border: 1px solid rgba(220, 38, 38, 0.3);
  }

  /* Animation for page load */
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .animate-fade-in {
    animation: fadeInUp 0.6s ease-out;
  }

  /* Staggered animation for cards */
  .animate-fade-in:nth-child(1) { animation-delay: 0.1s; }
  .animate-fade-in:nth-child(2) { animation-delay: 0.2s; }
  .animate-fade-in:nth-child(3) { animation-delay: 0.3s; }
  .animate-fade-in:nth-child(4) { animation-delay: 0.4s; }
  .animate-fade-in:nth-child(5) { animation-delay: 0.5s; }
  .animate-fade-in:nth-child(6) { animation-delay: 0.6s; }
</style>