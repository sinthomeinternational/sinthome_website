---
import PageLayout from "../../layouts/PageLayout.astro";
import H1 from "../../components/ui/H1.astro";
import EventTimeline from "../../components/srtp/EventTimeline.astro";
import { getCollection } from 'astro:content';
import { getLanguageFromURL } from "../../lib/translations";

// Get all SRTP events from content collection
const srtpEvents = await getCollection('srtpEvents');

// Get current language
const lang = getLanguageFromURL(Astro.url);

// Import images that we'll need
import readingSeminarImage from "../../assets/reading-seminar.png";
---

<PageLayout
  title="Sinthome Reading, Theory, Praxis (S.R.T.P.) - Sinthome"
  description="A radical education collective bridging theory and praxis through reading seminars, philosophy lectures, and critical discussions."
>
  <H1>Sinthome Reading, Theory, Praxis</H1>

  <!-- Hero Section -->
  <section class="mb-12">
    <p class="text-xl text-zinc-400 mb-8 max-w-3xl">
      S.R.T.P. is a <span class="text-red-400 font-semibold">radical education collective</span> that brings together
      activists, scholars, and community members to engage with revolutionary theory and its practical applications.
    </p>

    <!-- Quick Stats Bar -->
    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-8">
      <div class="bg-zinc-900/50 border border-zinc-800 rounded-lg p-4">
        <div class="text-2xl font-bold text-red-500">{srtpEvents.length}+</div>
        <div class="text-sm text-zinc-500">Events Hosted</div>
      </div>
      <div class="bg-zinc-900/50 border border-zinc-800 rounded-lg p-4">
        <div class="text-2xl font-bold text-red-500">Weekly</div>
        <div class="text-sm text-zinc-500">Reading Groups</div>
      </div>
      <div class="bg-zinc-900/50 border border-zinc-800 rounded-lg p-4">
        <div class="text-2xl font-bold text-red-500">Free</div>
        <div class="text-sm text-zinc-500">Always Open Access</div>
      </div>
    </div>

    <!-- CTA Section -->
    <div class="flex flex-wrap gap-4">
      <a
        href="#past-events"
        class="px-6 py-3 bg-red-600 text-white font-medium rounded-lg hover:bg-red-700 transition"
      >
        Browse Past Events
      </a>
      <a
        href="#join"
        class="px-6 py-3 border border-zinc-700 text-zinc-300 font-medium rounded-lg hover:bg-zinc-900 transition"
      >
        Join Our Next Session
      </a>
    </div>
  </section>

  <!-- What We Do -->
  <section class="mb-16">
    <h2 class="text-2xl font-bold text-white mb-6">What We Do</h2>

    <div class="grid md:grid-cols-3 gap-6 mb-8">
      <div class="bg-zinc-900/50 border border-zinc-800 rounded-xl p-6">
        <div class="w-12 h-12 bg-red-600/20 rounded-lg flex items-center justify-center mb-4">
          <svg class="w-6 h-6 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
          </svg>
        </div>
        <h3 class="text-lg font-semibold text-white mb-2">Reading Seminars</h3>
        <p class="text-zinc-400 text-sm">
          Weekly gatherings to collectively read and discuss revolutionary texts, from Marx to contemporary critical theory.
        </p>
      </div>

      <div class="bg-zinc-900/50 border border-zinc-800 rounded-xl p-6">
        <div class="w-12 h-12 bg-red-600/20 rounded-lg flex items-center justify-center mb-4">
          <svg class="w-6 h-6 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
          </svg>
        </div>
        <h3 class="text-lg font-semibold text-white mb-2">Philosophy Lectures</h3>
        <p class="text-zinc-400 text-sm">
          Deep dives into critical philosophy, connecting abstract concepts to concrete political struggles.
        </p>
      </div>

      <div class="bg-zinc-900/50 border border-zinc-800 rounded-xl p-6">
        <div class="w-12 h-12 bg-red-600/20 rounded-lg flex items-center justify-center mb-4">
          <svg class="w-6 h-6 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
          </svg>
        </div>
        <h3 class="text-lg font-semibold text-white mb-2">Practice Groups</h3>
        <p class="text-zinc-400 text-sm">
          Workshops connecting theoretical insights to organizing strategies and community action.
        </p>
      </div>
    </div>

    <!-- Current Focus -->
    <div class="bg-gradient-to-r from-red-900/20 to-transparent border border-red-600/30 rounded-xl p-6">
      <h3 class="text-lg font-semibold text-white mb-3">Current Focus Areas</h3>
      <ul class="grid sm:grid-cols-2 gap-3 text-zinc-400">
        <li class="flex items-start gap-2">
          <span class="text-red-500 mt-1">‚Üí</span>
          <span>Dialectical materialism and revolutionary methodology</span>
        </li>
        <li class="flex items-start gap-2">
          <span class="text-red-500 mt-1">‚Üí</span>
          <span>Phenomenology of suffering and bodily ethics</span>
        </li>
        <li class="flex items-start gap-2">
          <span class="text-red-500 mt-1">‚Üí</span>
          <span>Social space production and urban struggle</span>
        </li>
        <li class="flex items-start gap-2">
          <span class="text-red-500 mt-1">‚Üí</span>
          <span>Labor organization and worker consciousness</span>
        </li>
      </ul>
    </div>
  </section>

  <!-- Past Events Timeline -->
  <section id="past-events" class="mb-16">
    <div class="flex items-center justify-between mb-8">
      <h2 class="text-2xl font-bold text-white">Past Events</h2>
      <div class="flex gap-2">
        <button
          onclick="toggleView('timeline')"
          id="timeline-btn"
          class="px-4 py-2 text-sm font-medium bg-zinc-800 text-white rounded-lg transition"
        >
          Timeline
        </button>
        <button
          onclick="toggleView('grid')"
          id="grid-btn"
          class="px-4 py-2 text-sm font-medium text-zinc-400 hover:text-white hover:bg-zinc-800 rounded-lg transition"
        >
          Grid
        </button>
      </div>
    </div>

    <!-- Timeline View (default) -->
    <div id="timeline-view">
      <EventTimeline events={srtpEvents} lang={lang} />
    </div>

    <!-- Grid View (hidden by default) -->
    <div id="grid-view" class="hidden">
      <div class="grid md:grid-cols-2 gap-6">
        {srtpEvents.sort((a, b) => b.data.date.getTime() - a.data.date.getTime()).map((event) => (
          <article class="bg-zinc-900/50 border border-zinc-800 rounded-xl overflow-hidden hover:border-red-600/50 transition">
            <div class="p-6">
              <div class="flex flex-wrap gap-2 mb-3">
                <span class="px-2 py-1 text-xs font-medium bg-red-600/20 text-red-400 rounded">
                  {event.data.type}
                </span>
                <span class="text-xs text-zinc-500">
                  {event.data.date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}
                </span>
              </div>
              <h3 class="text-lg font-bold text-white mb-2">{event.data.title}</h3>
              <p class="text-zinc-400 text-sm mb-4 line-clamp-3">{event.data.synopsis}</p>
              <div class="flex justify-between items-center">
                <a
                  href={`/events/${event.id}`}
                  class="text-red-400 hover:text-red-300 text-sm font-medium"
                >
                  Read More ‚Üí
                </a>
                {event.data.recordingUrl && (
                  <a
                    href={event.data.recordingUrl}
                    target="_blank"
                    rel="noopener noreferrer"
                    class="text-zinc-500 hover:text-white text-sm"
                  >
                    Watch Recording
                  </a>
                )}
              </div>
            </div>
          </article>
        ))}
      </div>
    </div>
  </section>

  <!-- Join Section -->
  <section id="join" class="mb-16">
    <div class="bg-gradient-to-br from-red-900/20 via-zinc-900/50 to-transparent border border-red-600/30 rounded-xl p-8">
      <h2 class="text-2xl font-bold text-white mb-4">Join Our Community</h2>
      <p class="text-zinc-400 mb-6 max-w-2xl">
        S.R.T.P. sessions are free and open to all. No prior knowledge required‚Äîjust a commitment to collective learning and radical imagination.
      </p>

      <div class="grid sm:grid-cols-2 gap-6 mb-8">
        <div>
          <h3 class="text-lg font-semibold text-white mb-3">Next Session</h3>
          <p class="text-zinc-400 mb-2">üìÖ Every Saturday, 2:00 PM</p>
          <p class="text-zinc-400 mb-2">üìç 175 Washington St, Brighton, MA</p>
          <p class="text-zinc-400">üí¨ Also available online via Zoom</p>
        </div>
        <div>
          <h3 class="text-lg font-semibold text-white mb-3">Stay Updated</h3>
          <p class="text-zinc-400 mb-4">
            Get notified about upcoming events, reading materials, and discussion topics.
          </p>
          <a
            href="/contact"
            class="inline-block px-6 py-3 bg-red-600 text-white font-medium rounded-lg hover:bg-red-700 transition"
          >
            Join Mailing List
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- FAQ Section -->
  <section class="mb-16">
    <h2 class="text-2xl font-bold text-white mb-6">Frequently Asked Questions</h2>

    <div class="space-y-4">
      <details class="group bg-zinc-900/50 border border-zinc-800 rounded-lg">
        <summary class="cursor-pointer p-6 text-white font-medium hover:text-red-400 transition">
          Do I need to prepare anything before attending?
        </summary>
        <div class="px-6 pb-6 text-zinc-400">
          Not at all! While we often share reading materials in advance, you're welcome to join even if you haven't read them. The discussion itself is where learning happens.
        </div>
      </details>

      <details class="group bg-zinc-900/50 border border-zinc-800 rounded-lg">
        <summary class="cursor-pointer p-6 text-white font-medium hover:text-red-400 transition">
          Are sessions really free?
        </summary>
        <div class="px-6 pb-6 text-zinc-400">
          Yes, completely free. We believe education should be accessible to all. We're funded through community donations and solidarity economy practices.
        </div>
      </details>

      <details class="group bg-zinc-900/50 border border-zinc-800 rounded-lg">
        <summary class="cursor-pointer p-6 text-white font-medium hover:text-red-400 transition">
          Can I propose topics or lead a session?
        </summary>
        <div class="px-6 pb-6 text-zinc-400">
          Absolutely! S.R.T.P. is collectively organized. Contact us with your ideas, and we'll work together to make it happen.
        </div>
      </details>

      <details class="group bg-zinc-900/50 border border-zinc-800 rounded-lg">
        <summary class="cursor-pointer p-6 text-white font-medium hover:text-red-400 transition">
          Is this affiliated with any political party?
        </summary>
        <div class="px-6 pb-6 text-zinc-400">
          No. While we engage with radical and revolutionary theory, S.R.T.P. is an independent collective not affiliated with any political party or organization.
        </div>
      </details>

      <details class="group bg-zinc-900/50 border border-zinc-800 rounded-lg">
        <summary class="cursor-pointer p-6 text-white font-medium hover:text-red-400 transition">
          Are recordings available?
        </summary>
        <div class="px-6 pb-6 text-zinc-400">
          Yes! Most sessions are recorded and posted to our Bilibili channel. Check the past events section for links to specific recordings.
        </div>
      </details>

      <details class="group bg-zinc-900/50 border border-zinc-800 rounded-lg">
        <summary class="cursor-pointer p-6 text-white font-medium hover:text-red-400 transition">
          How can I support S.R.T.P.?
        </summary>
        <div class="px-6 pb-6 text-zinc-400">
          Join us! Your participation is the best support. You can also help by sharing events, volunteering to facilitate, or contributing to our solidarity fund.
        </div>
      </details>
    </div>
  </section>
</PageLayout>

<script>
  function toggleView(view: 'timeline' | 'grid') {
    const timelineView = document.getElementById('timeline-view');
    const gridView = document.getElementById('grid-view');
    const timelineBtn = document.getElementById('timeline-btn');
    const gridBtn = document.getElementById('grid-btn');

    if (view === 'timeline') {
      timelineView?.classList.remove('hidden');
      gridView?.classList.add('hidden');
      timelineBtn?.classList.add('bg-zinc-800', 'text-white');
      timelineBtn?.classList.remove('text-zinc-400', 'hover:text-white', 'hover:bg-zinc-800');
      gridBtn?.classList.remove('bg-zinc-800', 'text-white');
      gridBtn?.classList.add('text-zinc-400', 'hover:text-white', 'hover:bg-zinc-800');
    } else {
      timelineView?.classList.add('hidden');
      gridView?.classList.remove('hidden');
      gridBtn?.classList.add('bg-zinc-800', 'text-white');
      gridBtn?.classList.remove('text-zinc-400', 'hover:text-white', 'hover:bg-zinc-800');
      timelineBtn?.classList.remove('bg-zinc-800', 'text-white');
      timelineBtn?.classList.add('text-zinc-400', 'hover:text-white', 'hover:bg-zinc-800');
    }
  }

  // Add to global scope for onclick handlers
  (window as any).toggleView = toggleView;
</script>

<style>
  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  details summary::-webkit-details-marker {
    display: none;
  }

  details summary::before {
    content: '+';
    position: absolute;
    right: 1.5rem;
    font-size: 1.5rem;
    transition: transform 0.3s;
  }

  details[open] summary::before {
    transform: rotate(45deg);
  }
</style>