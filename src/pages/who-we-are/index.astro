---
import PageLayout from "../../layouts/PageLayout.astro";
import H1 from "../../components/ui/H1.astro";
import { getTranslations, getLanguageFromURL } from "../../lib/translations";
import { getThemeFromURL } from "../../lib/utils";

// Get current language and theme from URL (SSR-compatible)
const lang = getLanguageFromURL(Astro.url);
const theme = getThemeFromURL(Astro.url);
const t = getTranslations(lang);
const pageContent = t.pages.whoWeAre;

---

<PageLayout title={`${pageContent.title} - Sinthome`} useInfoLayout={true} theme={theme}>
    <H1>{pageContent.title}</H1>

    {pageContent.subtitle && (
      <p class="text-xl mb-8 max-w-4xl" style="color: var(--theme-text-secondary);">
        {pageContent.subtitle}
      </p>
    )}

    <div class="space-y-12 max-w-4xl" style="color: var(--theme-text-secondary);">
      {pageContent.sections?.map((section: any) => (
        <section>
          <h2 class="text-2xl font-bold mb-4" style="color: var(--theme-text-primary);">
            {section.title}
          </h2>

          {/* Handle content as string or array */}
          {section.content && (
            Array.isArray(section.content) ? (
              section.content.map((paragraph: any) => (
                <p class="leading-relaxed mb-4">
                  {paragraph}
                </p>
              ))
            ) : (
              <p class="leading-relaxed mb-4">{section.content}</p>
            )
          )}

          {/* Handle items if present */}
          {section.items && section.items.length > 0 && (
            <div class="space-y-4 mt-4">
              {section.items.map((item: any) => (
                <div class="rounded-lg p-6" style="background-color: var(--theme-bg-card); border: 1px solid var(--theme-border);">
                  <h3 class="text-lg font-semibold mb-2" style="color: var(--theme-text-primary);">
                    {item.name || item.title}
                  </h3>
                  <p style="color: var(--theme-text-secondary);">
                    {item.description}
                  </p>
                </div>
              ))}
            </div>
          )}
        </section>
      ))}

      {/* Call to Action Section */}
      {pageContent.callToAction && (
        <section class="mt-12 p-8 rounded-lg text-center" style="background-color: var(--theme-bg-card); border: 1px solid var(--theme-border);">
          <h2 class="text-2xl font-bold mb-4" style="color: var(--theme-text-primary);">
            {pageContent.callToAction.title}
          </h2>
          <p class="mb-6" style="color: var(--theme-text-secondary);">
            {pageContent.callToAction.description}
          </p>
          <div class="flex flex-wrap gap-4 justify-center">
            {pageContent.callToAction.buttons && (
              <>
                <a
                  href={`/donate${lang === 'zh' ? '?lang=zh' : ''}`}
                  class="px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors"
                >
                  {pageContent.callToAction.buttons.donate}
                </a>
                <a
                  href={`/contact${lang === 'zh' ? '?lang=zh' : ''}`}
                  class="px-6 py-3 rounded-lg transition-colors"
                  style="background-color: var(--theme-bg-secondary); color: var(--theme-text-primary); border: 1px solid var(--theme-border);"
                >
                  {pageContent.callToAction.buttons.getInvolved}
                </a>
              </>
            )}
          </div>
        </section>
      )}
    </div>
</PageLayout>